### Контакты
В открытом репозитории... Как-то не здорово. В форме же все указывается.

### Окружение
PHP 7.2 + расширения: curl и sqlite3(для серверной части). 
phpunit 8.0.6

### Описание работы
#### 4 основных модуля:
1) Satellite. По сути виртуальная машина для FlyProgram.
2) Exchanger. Общается с API.
3) QueryManager. Менеджер очередей сообщений. Через него общаются Satellite и Exchanger.
4) Telemetry. Весь текстовый ввод-вывод. Телеметрия, ошибки, логирование.

Все, кроме Satellite, реализуют соответствующие интерфейсы, что позволяет безболезненно менять реализацию.

Для связи Satellite и Exchanger выбрал механизм менеджера очередей. Это позволит горизонтально масштабировать количество Exchanger'ов.

Чтобы не прикручивать сторонний MQ написал его самую простую реализацию, работающую в том же потоке, что и сам спутник. Соответственно и Exchanger не асинхронен. Но вынести в разные процессы, в принципе, особых проблем нет.

#### Компиляция плана полета
##### Первый этап
Разбор исходного JSON и набивка программы задачами:

   - SetOperation (установка значения параметра)
   - CheckOperation (проверка, что параметр достиг заданного значение в срок)
   - TelemetryOperation (надо отправить телеметрию)[^1]
   - GetOperation (запросить значения параметров для задач CheckOperation и TelemetryOperation)

На данном этапе, также, происходит проверка корректности программы: уникальные ID, корректные значения в SetOperation(не выходят за границы min/max для параметра) и т.д.

По хорошему не хватает потокового анализа на предмет коллизий типа: установили 100 с контролем через 10с, а потом сразу установили -100 с контролем через секунду.

##### Первый этап
Оптимизация программы. Минимизация количества и объема запросов для каждого deltaT.

   - Консолидация GetOperation. Объединяем все GetOperation в одну и убираем из него параметры, которые получим через SetOperation
   - Консолидация SetOperation. Помещаем все SetOperation в BatchSetOperation
   - Добавляем StartOperation и FinishOperation[^1]

[^1]: Тут спорный момент. В принципе эти операции никто не мешает выставлять по факту в процессе работы виртуальной машины.

### Тестирование
Настройки параметров лежат в parameters.json
speed - скоросто изменения параметра. Если 0, то меняется мнгновенно.

Настройки переменных окружения в ./test/environment.php

#### Unit-тесты 
Лежат в директории ./test. Там же phpunit.xml.dist

#### Прогон программы полета (необходимо расширение sqlite3)

1) В отдельном окне, из  запускаем сервер:
php -S localhost:80 server.php

2) В другом окне запускаем main_test.php

Там две программы.
Первая корректная, а вторая с коллизией, как описано в 1-ом шаге компиляции FlyProgram - завершится с кодом 12.

Сервер наколеночный и совсем простой(и может не совсем корректно вычислять промежуточные значения).
Для проверки отсутствия связи/таймаута можно просто прервать его процесс :)

На всякий случай добавил лог прогона ./test/output.log

Тут много где хорошо бы отполировать SOLID'ом, но, боюсь, в погоне за совершенством просто не успел бы к сроку. :)

### Трудозатраты

Первоначально оценил в 6 часов. Первый рабочий прототип примерно за такое время и сделал.

Сколько часов ушло на вот это конечное решение посчитать не берусь. Это было примерно 5 рабочих дней в свободное от основной работы время.